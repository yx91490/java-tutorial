(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{649:function(t,s,n){"use strict";n.r(s);var a=n(27),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"finally"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#finally"}},[t._v("#")]),t._v(" finally")]),t._v(" "),n("p",[t._v("finally 块总是当 try 块退出执行。\n这确保了即使是在执行中发生了异常，finally 也会执行。但它不仅仅是处理异常，还避免了你不小心绕过了一些资源清除的代码。\n比如 "),n("code",[t._v("return")]),t._v("、"),n("code",[t._v("continue")]),t._v(" or "),n("code",[t._v("break")]),t._v(" 的时候。这往往是非常有用的")]),t._v(" "),n("p",[t._v("但最终不仅仅是异常处理是有用的 —— 它允许程序员避免清除代码不小心绕过热土，继续或休息。\n将在 finally 块中清理代码总是一个很好的实践，即使不预期的异常。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("如果 JVM 在执行 try 或 catch 代码时退出，则 finally 块可能无法执行。\n同样，如果执行 try 或 catch 代码的线程被中断或杀死，则该 finally 块可能不执行，\n即使应用程序作为一个整体继续。")])]),t._v(" "),n("p",[t._v("例如前面的例子：打开一个 PrintWriter。程序应 在writeList 方法退出之前关闭该流，但是该方法有以下几种退出方式：")]),t._v(" "),n("ol",[n("li",[t._v("new FileWriter 语句失败并引发 IOException。")]),t._v(" "),n("li",[n("code",[t._v("list.get(i)")]),t._v(" 语句失败并引发 IndexOutOfBoundsException。")]),t._v(" "),n("li",[t._v("一切成功，try 块正常退出。")])]),t._v(" "),n("p",[t._v("运行时系统总是执行 "),n("code",[t._v("finally")]),t._v(" 块内的语句，而不管 try 块发生了什么，所以它是执行清理操作的完美场所。")]),t._v(" "),n("p",[t._v("下面演示了 finally 的 writeList 方法的清理功能")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Closing PrintWriter"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PrintWriter not open"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("该 "),n("code",[t._v("finally")]),t._v(" 块是防止资源泄漏的关键工具。在关闭文件或其他方式恢复资源时，\n那个代码放在 "),n("code",[t._v("finally")]),t._v("块中。也可以考虑使用 "),n("code",[t._v("try-with-resources")]),t._v(" 语句，\n这会在不需要该资源时自动释放系统资源。下节会介绍。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);